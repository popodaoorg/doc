# ğŸ”— ç­¾åç®—æ³•

## ç­¾åç”Ÿæˆçš„é€šç”¨æ­¥éª¤å¦‚ä¸‹

1. è®¾æ‰€æœ‰å‘é€æˆ–è€…æ¥æ”¶åˆ°çš„æ•°æ®ä¸ºé›†åˆMï¼Œå°†é›†åˆMå†…éç©ºå‚æ•°å€¼çš„å‚æ•°æŒ‰ç…§å‚æ•°å ASCII ç ä»å°åˆ°å¤§æ’åºï¼ˆå­—å…¸åºï¼‰ï¼Œä½¿ç”¨ URL é”®å€¼å¯¹çš„æ ¼å¼ï¼ˆå³key1=value1\&key2=value2â€¦ï¼‰æ‹¼æ¥æˆå­—ç¬¦ä¸² stringAã€‚
2. åœ¨ stringA æœ€åæ‹¼æ¥ä¸Š `&appsecret=å¯†é’¥` å¾—åˆ° stringSignTemp å­—ç¬¦ä¸²ï¼Œå¹¶å¯¹stringSignTemp è¿›è¡Œ MD5 è¿ç®—ï¼Œå†å°†å¾—åˆ°çš„å­—ç¬¦ä¸²æ‰€æœ‰å­—ç¬¦è½¬æ¢ä¸ºå¤§å†™ï¼Œå¾—åˆ°signå€¼ã€‚



## ç‰¹åˆ«æ³¨æ„ä»¥ä¸‹é‡è¦è§„åˆ™

* å‚æ•°å ASCII ç ä»å°åˆ°å¤§æ’åºï¼ˆå­—å…¸åºï¼‰ï¼›
* å¦‚æœå‚æ•°çš„å€¼ä¸ºç©ºä¸å‚ä¸ç­¾åï¼›
* å‚æ•°ååŒºåˆ†å¤§å°å†™ï¼›
* éªŒè¯è°ƒç”¨è¿”å›æˆ–å¹³å°ä¸»åŠ¨é€šçŸ¥ç­¾åæ—¶ï¼Œä¼ é€çš„ sign å‚æ•°ä¸å‚ä¸ç­¾åï¼Œå°†ç”Ÿæˆçš„ç­¾åä¸è¯¥ sign å€¼ä½œæ ¡éªŒã€‚
* æ¥å£å¯èƒ½å¢åŠ å­—æ®µï¼ŒéªŒè¯ç­¾åæ—¶å¿…é¡»æ”¯æŒå¢åŠ çš„æ‰©å±•å­—æ®µã€‚



## ä¸¾ä¾‹

ä¾‹å¦‚ä¼ é€’çš„å‚æ•°å¦‚ä¸‹ï¼š

```
appid: 12345
pay_money: 1
order_sn: 123123123123
```

ç¬¬ä¸€æ­¥ï¼šå¯¹å‚æ•°æŒ‰ç…§ key=value çš„æ ¼å¼ï¼Œå¹¶æŒ‰ç…§å‚æ•°å ASCII å­—å…¸åºæ’åºå¦‚ä¸‹

{% code overflow="wrap" %}
```php
appid=12345&order_sn=123123123123&pay_money=1
```
{% endcode %}

ç¬¬äºŒæ­¥ï¼šå¯¹ä¸Šä¸€æ­¥ä¸­çš„å­—ç¬¦ä¸²æ‹¼æ¥ `&appsecret=å¯†é’¥`

{% code overflow="wrap" %}
```php
appid=12345&order_sn=123123123123&pay_money=1&appsecret=xxxxxxxxx
```
{% endcode %}

ç¬¬ä¸‰æ­¥ï¼šå¯¹ä¸Šä¸€æ­¥ä¸­å­—ç¬¦ä¸²å– md5 å€¼

{% code overflow="wrap" %}
```php
$sign = md5('appid=12345&order_sn=123123123123&pay_money=1&appsecret=xxxxxxxxx');
```
{% endcode %}

ç¬¬å››æ­¥ï¼šå¯¹ä¸Šé¢ md5 å€¼è½¬åŒ–ä¸ºå¤§å†™

```php
$sign = strtoupper($sign);
```



## PHPä»£ç ç¤ºä¾‹

```php
// ç­¾åæ–¹æ³•
function sign(array $data, $appsecret) {
    ksort($data);
    $sign = strtoupper(md5(urldecode(http_build_query($data)).'&appsecret='.$appsecret));
    return $sign;
}

// ç”¨æ³•ç¤ºä¾‹
$data = [
    'appid' => '12345',
    'pay_money' => 1,
    'order_sn' => '123123123123',
];

// å¹³å°é€šä¿¡å¯†é’¥
$appsecret = 'xxxxxxxxxxx';
$sign = sign($data, $appsecret);

```

\
